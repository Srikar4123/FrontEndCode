<section class="container">
  <!-- Toolbar -->
  <header class="toolbar">
    <h2>User Loan & Fine Summary</h2>

    <button (click)="load()">Refresh</button>
  </header>

  <!-- Status -->
  <div class="status" *ngIf="loading">Loading summary...</div>
  <div class="error" *ngIf="error">{{ error }}</div>

  <!-- Table -->
  <ng-container *ngIf="summaries$ | async as summaries">
    <table class="grid" *ngIf="summaries.length > 0; else emptyState">
      <thead>
        <tr>
          <th>User</th>
          <th>Total Loans</th>
          <th>Active Loans</th>
          <th>Overdue</th>
          <th>Unpaid Fines</th>
          <th>Total Outstanding (₹)</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let s of summaries; trackBy: trackByUserId">
          <td>{{ s.userName }}</td>
          <td>{{ s.totalLoans }}</td>
          <td>{{ s.activeLoans }}</td>

          <td class="overdue" *ngIf="s.overdueLoans > 0; else ok">
            {{ s.overdueLoans }}
          </td>
          <ng-template #ok>
            <td>0</td>
          </ng-template>

          <td>{{ s.unpaidFineCount }}</td>
          <td>₹{{ s.totalOutstanding }}</td>

          <td class="actions">
            <button class="link" (click)="viewUserLoans(s.userId)">View Details</button>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #emptyState>
      <div *ngIf="!loading" class="empty">No loan data available.</div>
    </ng-template>
  </ng-container>
</section>
